# =============================================================================
# tmux.conf - Dracula Theme with Ghostty Transparency Support
# =============================================================================
# Environment: macOS (Ghostty) -> AWS EC2 Ubuntu (ZSH)
# Theme: Dracula
# Features: Transparent background support, modern keybindings, productivity plugins
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------

# Change prefix key to Ctrl+a (easier to press than Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# 256 color and True Color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",ghostty:Tc"

# Set default shell to ZSH
set -g default-shell /bin/zsh

# Start window and pane indices at 1
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows
set -g renumber-windows on


# Repeat key timeout
set -g repeat-time 500

# Enable mouse support
set -g mouse on

# -----------------------------------------------------------------------------
# Key Bindings
# -----------------------------------------------------------------------------

# Reload configuration file
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Pane splitting (intuitive keys)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
unbind '"'
unbind %

# Open new window in current path
bind c new-window -c "#{pane_current_path}"

# Pane navigation (Vim-style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt + arrow keys for pane navigation
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Pane resizing (Vim-style)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window switching
bind -n S-Left previous-window
bind -n S-Right next-window

# Copy mode with Prefix + v
bind v copy-mode

# Use Vim keybindings in copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel

# Session switching
bind s choose-tree -sZ

# Toggle synchronized pane input
bind S setw synchronize-panes \; display "Sync #{?synchronize-panes,ON,OFF}"

# -----------------------------------------------------------------------------
# Dracula Theme Plugin Configuration
# -----------------------------------------------------------------------------
# Repository: https://github.com/dracula/tmux
# Note: Theme is loaded via TPM plugin below
# -----------------------------------------------------------------------------

# Available plugins: battery, cpu-usage, git, gpu-usage, ram-usage, tmux-ram-usage,
# network, network-bandwidth, network-ping, ssh-session, attached-clients, network-vpn,
# weather, time, mpc, spotify-tui, playerctl, kubernetes-context, synchronize-panes
set -g @dracula-plugins "git cpu-usage ram-usage time"

# Show powerline symbols
set -g @dracula-show-powerline true

# Show left icon (session, smiley, window, hostname, shortname, or custom)
set -g @dracula-show-left-icon "#h | #S"

# Enable high contrast pane border
set -g @dracula-border-contrast true

# Show flags (window flags like *, -, #, etc.)
set -g @dracula-show-flags true

# Refresh rate for status bar (seconds)
set -g @dracula-refresh-rate 5

# Time format (12/24 hour)
set -g @dracula-military-time true

# Show timezone
set -g @dracula-show-timezone false

# Custom time format (YYYY-MM-DD HH:MM)
set -g @dracula-time-format "%Y-%m-%d %H:%M"

# CPU usage settings
set -g @dracula-cpu-usage-label "CPU"
set -g @dracula-cpu-display-load false

# RAM usage settings
set -g @dracula-ram-usage-label "RAM"

# Network settings (if using network plugins)
# set -g @dracula-network-bandwidth eth0
# set -g @dracula-network-bandwidth-interval 0
# set -g @dracula-network-bandwidth-show-interface true

# Git settings (if using git plugin)
set -g @dracula-git-disable-status true
set -g @dracula-git-show-current-symbol âœ“
set -g @dracula-git-show-diff-symbol !
set -g @dracula-git-no-repo-message ""
set -g @dracula-git-no-untracked-files true
set -g @dracula-git-show-remote-status true

# Hide plugins when they have no content to display
set -g @dracula-show-empty-plugins false

# Transparent background support for Ghostty
set -g status-style "bg=default"

# -----------------------------------------------------------------------------
# Active Pane Highlighting (with transparency preserved)
# -----------------------------------------------------------------------------

# Pane border colors (Dracula palette)
set -g pane-border-style "fg=#44475a,bg=default"
set -g pane-active-border-style "fg=#bd93f9,bg=default"

# Dim inactive panes (make active pane stand out)
set -g window-style "fg=#6272a4,bg=default"
set -g window-active-style "fg=#f8f8f2,bg=default"

# -----------------------------------------------------------------------------
# Plugins (TPM: Tmux Plugin Manager)
# -----------------------------------------------------------------------------
# Installation:
# git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm
# After starting tmux, press prefix + I to install plugins
# -----------------------------------------------------------------------------

# Set plugin installation path (~/.config/tmux/plugins/)
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.config/tmux/plugins/'

# TPM itself
set -g @plugin 'tmux-plugins/tpm'

# Sensible tmux defaults
set -g @plugin 'tmux-plugins/tmux-sensible'

# Dracula theme
set -g @plugin 'dracula/tmux'

# Session persistence (restore after restart)
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Automatic session saving and restoration
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Enhanced copy and paste
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @yank-selection 'clipboard'

# File tree sidebar
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @sidebar-tree-command 'tree -C'

# Seamless navigation between Vim and tmux panes
set -g @plugin 'christoomey/vim-tmux-navigator'

# -----------------------------------------------------------------------------
# TPM Initialization (must be at the very bottom of tmux.conf)
# -----------------------------------------------------------------------------
run '~/.config/tmux/plugins/tpm/tpm'

# =============================================================================
# Quick Reference
# =============================================================================
# Prefix: Ctrl+a
#
# Pane Operations:
#   prefix + | or \  : Vertical split
#   prefix + -       : Horizontal split
#   prefix + h/j/k/l : Navigate panes (Vim-style)
#   prefix + H/J/K/L : Resize panes
#   Alt + Arrow      : Navigate panes
#
# Window Operations:
#   prefix + c       : New window
#   Shift + Left/Right : Switch windows
#   prefix + s       : Session picker
#
# Other:
#   prefix + r       : Reload config
#   prefix + S       : Toggle pane sync
#   prefix + I       : Install plugins (TPM)
#   prefix + U       : Update plugins (TPM)
# =============================================================================
